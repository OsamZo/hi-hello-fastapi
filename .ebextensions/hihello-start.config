files:
  "/sbin/appstart":
    mode: "000755"
    owner: webapp
    group: webapp
    content: |
      #!/bin/bash
      set -e

      echo "Activating Python Virtual Environment"
      VENV_PATH="/var/app/current/venv"
      if [ -d "$VENV_PATH" ]; then
          source $VENV_PATH/bin/activate
          echo "Virtual environment activated at $VENV_PATH"
      else
          echo "Error: Virtual environment not found at $VENV_PATH"
          exit 1
      fi

      echo "Starting FastAPI application"
      python -m uvicorn app.main:app --host 0.0.0.0 --port 8000

option_settings:
  aws:elasticbeanstalk:application:environment:
    ENV: production
    DATABASE_URL: "{DATABASE_URL}"
    PINECONE_API_KEY: "{PINECONE_API_KEY}"
    PINECONE_ENV: "{PINECONE_ENV}"
    PINECONE_HOST: "{PINECONE_HOST}"
    AWS_ACCESS_KEY_ID: "{AWS_ACCESS_KEY_ID}"
    AWS_SECRET_ACCESS_KEY: "{AWS_SECRET_ACCESS_KEY}"
    UPSTAGE_API_KEY: "{UPSTAGE_API_KEY}"

